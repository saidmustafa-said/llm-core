2025-03-23 17:48:03,983 - INFO - Logging setup completed
2025-03-23 17:48:10,972 - INFO - [llm_api] Called with prompt: i want to go to cafe, conversation_id: 21341
2025-03-23 17:48:10,972 - INFO - [retrieve_tags] Function called
2025-03-23 17:48:10,981 - DEBUG - [retrieve_tags] Retrieved tags: []
2025-03-23 17:48:10,988 - DEBUG - [retrieve_tags] Retrieved subcategories: amenity: bar,bbq,cafe,cinema,dancing_school,dive_centre,events_venue,exhibition_centre,fast_food,food_court,guest_house,hookah_lounge,ice_cream,internet_cafe,library,motel,nightclub,planetarium,pub,public_bath,restaurant,social_centre,social_club,theatre,vending_machine
historic: archaeological_site,boundary_stone,building,castle,cemetery,church,cistern,city_gate,column,drinking_fountain,fort,fountain,memorial,monument,ruins,tomb,tower,uncategorized
leisure: adult_gaming_centre,amusement_arcade,bath,beach_resort,bowling_alley,common,dance,dog_park,fitness_centre,fitness_station,garden,golf_course,horse_riding,indoor_play,marina,miniature_golf,nature_reserve,outdoor_seating,park,picnic_table,pitch,playground,resort,sauna,slipway,sports_centre,sports_hall,stadium,swimming_pool,tanning_salon,tree_garden,turkish_bath,uncategorized
natural: bay,beach,cape,cave_entrance,hill,hot_spring,peak,plateau,reef,shrub,sinkhole,Soap,spring,tree,wood,uncategorized
shop: accessories,accessory,advertising,agrarian,alcohol,animal_food,anime,antiques,appliance,art,association,Athletic_Club,attar,baby_goods,bag,Bag_shop,bakery,bathroom_furnishing,beauty,beauty_supply,bed,beverages,bicycle,billiard_shop,blacksmith,boat,bookmaker,books,boutique,building_materials,butcher,car,carpet,carpet_store,car_parts,car_repair,cheese,chemist,chocolate,cleaning,clothes,coffee,collector,computer,confectionery,convenience,copyshop,cosmetics,craft,curtain,dairy,deli,department_store,dessert,dessert_shop,doityourself,doors,dormitory,Dorms,dry_cleaning,electrical,electrics,electronics,erotic,estate_agent,fabric,farm,fashion_accessories,fireplace,fishing,flooring,florist,food,foreign_trade,frame,fuel,funeral_directors,furniture,games,garden_centre,garden_furniture,gas,general,gift,glass_bottles_shop,Glass_shop,glaziery,greengrocer,grocery,hairdresser,hairdresser_supply,hardware,health_food,hearing_aids,herbalist,hifi,hobby,home_good_store,hookah,household_items_shop,household_linen,houseware,hunting,hunting_gear_shop,hvac,ice_cream,IMPORT_EXPORT,interior_decoration,internet,jewelry,key_cutter,kiosk,kitchen,labels,laundry,leather,library,lighting,locksmith,lottery,mall,mannequin,massage,medical,medical_supply,military_surplus,mobile_phone,mobilya,model,motorcycle,motorcycle_repair,motors,music,musical_instrument,Natural_stones,nature,Navking,newsagent,Novelty_store,nutrition_supplements,nuts,office_supplies,optician,outdoor,outpost,Package_shop,paint,party,pasta,pastry,pawnbroker,perfumery,pet,pet_grooming,photo,photography,photo_studio,piano_shop,pickle,pickles,plumber,plumbing,pottery,power_equipment,printer_ink,radiotechnics,religion,rental,repair,restaurant,safe_vault_shop,scuba_diving,seafood,second_hand,security,sewing,shipment,shoes,shoe_repair,shopping_mall,slaughterhouse,soup_shop,spices,sports,stationery,stores_shopping_site,stroller,supermarket,tailor,tattoo,tea,telecommunication,textiles,ticket,tiles,tobacco,toys,trade,travel_agency,turkish_bath,tyres,umbrella,vacant,variety_store,video,video_games,watches,water,water_delivery,water_supplier,weapons,wheelchair,wholesale,wigs,window_blind,wine,uncategorized
sport: archery,basketball,billiards,chess,climbing,fencing,fitness,football,golf,gymnastics,ice_hockey,karate,karting,multi,pelota,pilates,safety_training,scuba_diving,shooting,skateboard,soccer,swimming,table_tennis,taekwondo,tennis,wrestling,yoga
2025-03-23 17:48:10,988 - INFO - [retrieve_tags] Output - Tags: None, Subcategories: amenity: bar,bbq,cafe,cinema,dancing_school,dive_centre,events_venue,exhibition_centre,fast_food,food_court,guest_house,hookah_lounge,ice_cream,internet_cafe,library,motel,nightclub,planetarium,pub,public_bath,restaurant,social_centre,social_club,theatre,vending_machine
historic: archaeological_site,boundary_stone,building,castle,cemetery,church,cistern,city_gate,column,drinking_fountain,fort,fountain,memorial,monument,ruins,tomb,tower,uncategorized
leisure: adult_gaming_centre,amusement_arcade,bath,beach_resort,bowling_alley,common,dance,dog_park,fitness_centre,fitness_station,garden,golf_course,horse_riding,indoor_play,marina,miniature_golf,nature_reserve,outdoor_seating,park,picnic_table,pitch,playground,resort,sauna,slipway,sports_centre,sports_hall,stadium,swimming_pool,tanning_salon,tree_garden,turkish_bath,uncategorized
natural: bay,beach,cape,cave_entrance,hill,hot_spring,peak,plateau,reef,shrub,sinkhole,Soap,spring,tree,wood,uncategorized
shop: accessories,accessory,advertising,agrarian,alcohol,animal_food,anime,antiques,appliance,art,association,Athletic_Club,attar,baby_goods,bag,Bag_shop,bakery,bathroom_furnishing,beauty,beauty_supply,bed,beverages,bicycle,billiard_shop,blacksmith,boat,bookmaker,books,boutique,building_materials,butcher,car,carpet,carpet_store,car_parts,car_repair,cheese,chemist,chocolate,cleaning,clothes,coffee,collector,computer,confectionery,convenience,copyshop,cosmetics,craft,curtain,dairy,deli,department_store,dessert,dessert_shop,doityourself,doors,dormitory,Dorms,dry_cleaning,electrical,electrics,electronics,erotic,estate_agent,fabric,farm,fashion_accessories,fireplace,fishing,flooring,florist,food,foreign_trade,frame,fuel,funeral_directors,furniture,games,garden_centre,garden_furniture,gas,general,gift,glass_bottles_shop,Glass_shop,glaziery,greengrocer,grocery,hairdresser,hairdresser_supply,hardware,health_food,hearing_aids,herbalist,hifi,hobby,home_good_store,hookah,household_items_shop,household_linen,houseware,hunting,hunting_gear_shop,hvac,ice_cream,IMPORT_EXPORT,interior_decoration,internet,jewelry,key_cutter,kiosk,kitchen,labels,laundry,leather,library,lighting,locksmith,lottery,mall,mannequin,massage,medical,medical_supply,military_surplus,mobile_phone,mobilya,model,motorcycle,motorcycle_repair,motors,music,musical_instrument,Natural_stones,nature,Navking,newsagent,Novelty_store,nutrition_supplements,nuts,office_supplies,optician,outdoor,outpost,Package_shop,paint,party,pasta,pastry,pawnbroker,perfumery,pet,pet_grooming,photo,photography,photo_studio,piano_shop,pickle,pickles,plumber,plumbing,pottery,power_equipment,printer_ink,radiotechnics,religion,rental,repair,restaurant,safe_vault_shop,scuba_diving,seafood,second_hand,security,sewing,shipment,shoes,shoe_repair,shopping_mall,slaughterhouse,soup_shop,spices,sports,stationery,stores_shopping_site,stroller,supermarket,tailor,tattoo,tea,telecommunication,textiles,ticket,tiles,tobacco,toys,trade,travel_agency,turkish_bath,tyres,umbrella,vacant,variety_store,video,video_games,watches,water,water_delivery,water_supplier,weapons,wheelchair,wholesale,wigs,window_blind,wine,uncategorized
sport: archery,basketball,billiards,chess,climbing,fencing,fitness,football,golf,gymnastics,ice_hockey,karate,karting,multi,pelota,pilates,safety_training,scuba_diving,shooting,skateboard,soccer,swimming,table_tennis,taekwondo,tennis,wrestling,yoga
2025-03-23 17:48:10,989 - DEBUG - [llm_api] API Request JSON: {
  "model": "llama3.1-70b",
  "messages": [
    {
      "role": "system",
      "content": "You are an AI specializing in location classification. Existing subcategories: amenity: bar,bbq,cafe,cinema,dancing_school,dive_centre,events_venue,exhibition_centre,fast_food,food_court,guest_house,hookah_lounge,ice_cream,internet_cafe,library,motel,nightclub,planetarium,pub,public_bath,restaurant,social_centre,social_club,theatre,vending_machine\nhistoric: archaeological_site,boundary_stone,building,castle,cemetery,church,cistern,city_gate,column,drinking_fountain,fort,fountain,memorial,monument,ruins,tomb,tower,uncategorized\nleisure: adult_gaming_centre,amusement_arcade,bath,beach_resort,bowling_alley,common,dance,dog_park,fitness_centre,fitness_station,garden,golf_course,horse_riding,indoor_play,marina,miniature_golf,nature_reserve,outdoor_seating,park,picnic_table,pitch,playground,resort,sauna,slipway,sports_centre,sports_hall,stadium,swimming_pool,tanning_salon,tree_garden,turkish_bath,uncategorized\nnatural: bay,beach,cape,cave_entrance,hill,hot_spring,peak,plateau,reef,shrub,sinkhole,Soap,spring,tree,wood,uncategorized\nshop: accessories,accessory,advertising,agrarian,alcohol,animal_food,anime,antiques,appliance,art,association,Athletic_Club,attar,baby_goods,bag,Bag_shop,bakery,bathroom_furnishing,beauty,beauty_supply,bed,beverages,bicycle,billiard_shop,blacksmith,boat,bookmaker,books,boutique,building_materials,butcher,car,carpet,carpet_store,car_parts,car_repair,cheese,chemist,chocolate,cleaning,clothes,coffee,collector,computer,confectionery,convenience,copyshop,cosmetics,craft,curtain,dairy,deli,department_store,dessert,dessert_shop,doityourself,doors,dormitory,Dorms,dry_cleaning,electrical,electrics,electronics,erotic,estate_agent,fabric,farm,fashion_accessories,fireplace,fishing,flooring,florist,food,foreign_trade,frame,fuel,funeral_directors,furniture,games,garden_centre,garden_furniture,gas,general,gift,glass_bottles_shop,Glass_shop,glaziery,greengrocer,grocery,hairdresser,hairdresser_supply,hardware,health_food,hearing_aids,herbalist,hifi,hobby,home_good_store,hookah,household_items_shop,household_linen,houseware,hunting,hunting_gear_shop,hvac,ice_cream,IMPORT_EXPORT,interior_decoration,internet,jewelry,key_cutter,kiosk,kitchen,labels,laundry,leather,library,lighting,locksmith,lottery,mall,mannequin,massage,medical,medical_supply,military_surplus,mobile_phone,mobilya,model,motorcycle,motorcycle_repair,motors,music,musical_instrument,Natural_stones,nature,Navking,newsagent,Novelty_store,nutrition_supplements,nuts,office_supplies,optician,outdoor,outpost,Package_shop,paint,party,pasta,pastry,pawnbroker,perfumery,pet,pet_grooming,photo,photography,photo_studio,piano_shop,pickle,pickles,plumber,plumbing,pottery,power_equipment,printer_ink,radiotechnics,religion,rental,repair,restaurant,safe_vault_shop,scuba_diving,seafood,second_hand,security,sewing,shipment,shoes,shoe_repair,shopping_mall,slaughterhouse,soup_shop,spices,sports,stationery,stores_shopping_site,stroller,supermarket,tailor,tattoo,tea,telecommunication,textiles,ticket,tiles,tobacco,toys,trade,travel_agency,turkish_bath,tyres,umbrella,vacant,variety_store,video,video_games,watches,water,water_delivery,water_supplier,weapons,wheelchair,wholesale,wigs,window_blind,wine,uncategorized\nsport: archery,basketball,billiards,chess,climbing,fencing,fitness,football,golf,gymnastics,ice_hockey,karate,karting,multi,pelota,pilates,safety_training,scuba_diving,shooting,skateboard,soccer,swimming,table_tennis,taekwondo,tennis,wrestling,yoga. Existing descriptive tags: None. User conversation history: None.  Analyze the user's prompt to determine which subcategories (only subcategory names, not categories) it fits into and which descriptive tags apply. Return the matching subcategories and descriptive tags. If the prompt does not exactly match any existing tag, generate new ones that better capture its essence. Return both subcategories and descriptive tags. If multiple valid subcategories exist and the intent is unclear, return a clarification question."
    },
    {
      "role": "user",
      "content": "Analyze this prompt: 'i want to go to cafe'"
    }
  ],
  "functions": [
    {
      "name": "extract_location_info",
      "description": "Extract the most relevant subcategories and descriptive tags from the user's prompt based on the provided context. For subcategories, compare the prompt with the existing list and return the relevant matches. For descriptive tags, do the same by returning matched tags or generating new descriptive words that capture the location's nuances. Ensure both subcategories and tags are unique, non-redundant, and appropriately capture the nuances of the location described in the prompt. If multiple subcategories are found and the intent is unclear, generate a clarification question.",
      "parameters": {
        "type": "object",
        "properties": {
          "subcategories": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "List of top 3 matching subcategories."
          },
          "tags": {
            "type": "object",
            "properties": {
              "existed": {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "description": "Top 3 descriptive tags that match existing ones."
              },
              "new": {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "description": "New descriptive tags generated from the prompt."
              }
            },
            "required": [
              "existed",
              "new"
            ]
          },
          "clarification": {
            "type": "object",
            "properties": {
              "needed": {
                "type": "boolean",
                "description": "True if clarification is needed, False if the classification is certain."
              },
              "question": {
                "type": "string",
                "description": "Clarification question to ask the user if needed."
              }
            },
            "required": [
              "needed",
              "question"
            ]
          }
        },
        "required": [
          "subcategories",
          "tags",
          "clarification"
        ]
      }
    }
  ],
  "function_call": "extract_location_info",
  "max_tokens": 5000,
  "temperature": 0.2
}
2025-03-23 17:48:12,776 - DEBUG - [llm_api] API Response JSON: {
  "created": 1742741292,
  "model": "llama3.1-70b",
  "usage": {
    "prompt_tokens": 1881,
    "completion_tokens": 51,
    "total_tokens": 1932
  },
  "choices": [
    {
      "finish_reason": "stop",
      "index": 0,
      "logprobs": null,
      "message": {
        "content": "<function=extract_location_info>{\"subcategories\": [\"cafe\"], \"tags\": {\"existed\": [], \"new\": [\"coffee\", \"relaxation\"]}, \"clarification\": {\"needed\": false, \"question\": \"\"}}</function>",
        "refusal": null,
        "role": "assistant",
        "audio": null,
        "function_call": null,
        "tool_calls": null
      }
    }
  ]
}
2025-03-23 17:48:12,777 - INFO - [extract_json] Function called
2025-03-23 17:48:12,777 - DEBUG - [extract_json] Extracted response content: <function=extract_location_info>{"subcategories": ["cafe"], "tags": {"existed": [], "new": ["coffee", "relaxation"]}, "clarification": {"needed": false, "question": ""}}</function>
2025-03-23 17:48:12,777 - WARNING - [extract_json] Direct JSON parsing failed, attempting regex extraction
2025-03-23 17:48:12,778 - INFO - [extract_json] Successfully extracted JSON using regex
2025-03-23 17:48:12,778 - INFO - [llm_api] Returning result: {
  "clarification": null,
  "categories": [
    "cafe"
  ],
  "tags": []
}
